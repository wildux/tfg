\newcolumntype{x}[1]{>{\centering\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash\hspace{0pt}}m{#1}}
%\definecolor{myBlue}{RGB}{210, 230, 255}
\definecolor{myBlue}{RGB}{217, 230, 242}

En aquest capítol es detallen els experiments realitzats i els resultats obtinguts a partir d'aquests.

\section{Experiments realitzats}
	S'han realitzat diversos expermients per comprovar tant la detecció de keypoints com la fiabilitat del matching. Els paràmetres utilitzats en tots els algormismes
	són els descrits al Capítol 5: Implementació.\\\\
	Podeu trobar el codi dels scripts utilitzats per la realització dels experiments a l'anex del treball.
	\subsection{Comparació detectors de keypoints}
		Els algorismes a comparar són:
		\begin{multicols}{3}  
			\begin{itemize}
				\item{Harris}
				\item{SIFT}
				\item{SURF}
				\item{ORB}
				\item{MSER}
			\end{itemize}
		\end{multicols}
		\noindent
		Tot i que la velocitat d'execució no és un factor determinant pel projecte, s'ha realitzat una comparació inicial de la velocitat d'execució dels algorismes de detecció de keypoints.\\\\
		Per mesurar el temps d'execució, s'ha fet la mitjana de 5 execucions de la funció d'obtenció de keypoints utilitzada.\\\\
		Un cop obtinguts els temps d'execució, s'ha analitzat la repetibilitat dels detectors.
\newpage
	\subsection{Comparació detecció i extracció de keypoints}
		En aquest experiment s'analitzen els diversos algorismes de detecció i extracció de keypoints, tant en la velocitat d'execució com en fiabilitat, que serà el més important pel sistema desenvolupat.\\\\
		Es compararan els següents algorismes:
		\begin{multicols}{3} 
			\begin{itemize}
				\item{Harris + SIFT}
				\item{Harris + ORB}
				\item{SIFT + SIFT}
				\item{SIFT + LATCH}
				\item{ORB + ORB}
				\item{ORB + BRISK}
			\end{itemize}
		\end{multicols}
		\noindent
		En primer lloc es provaran els algorismes utilitzant sub-imatges. Desprès es provarà el sistema amb imatges amb poques variacions (canvis d'il·luminació, blur...). L'última prova serà amb fotografies
		del campus i els jardins de palau reial, que presenten canvis de perspectiva i zoom entre d'altres.\\\\
		Per comprovar els matches, s'hauran de mirar manualment un per un, ja que les imatges no ens permeten utilitzar cap mecanisme per automatitzar el procès.
\newpage
\section{Resultats i comparació d'algorismes}

	\subsection{Detectors de keypoints}
	En primer lloc s'han realitzat proves amb imatges típiques de visió per computador.
		\begin{figure}[!htb]
			\minipage{0.32\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/graf3}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.32\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/boat}
				\label{fig:awesome_image2}
			\endminipage\hfill
			\minipage{0.32\textwidth}%
				\includegraphics[width=\linewidth]{images/experiments/ubc}
				\label{fig:awesome_image3}
			\endminipage
			\caption{Imatges graff, boat i ubc}
		\end{figure}

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				%\begin{tabular}{l | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c}
				\begin{tabular}{l | c c | c c | c c}
					& \multicolumn{2}{c|}{\textbf{Graff}} & \multicolumn{2}{c|}{\textbf{Boat}} & \multicolumn{2}{c}{\textbf{Ubc}} \\
					\textbf{Algorismes} & \textbf{Punts} & \textbf{Temps (s)} & \textbf{Punts} & \textbf{Temps (s)} & \textbf{Punts} & \textbf{Temps (s)} \\ \hline
					Harris & 1285 & 0.0123 & 1666 & 0.0124 & 1329 & 0.0101 \\
					SIFT & 1096 & 0.0675 & 1599 & 0.0755 & 1284 & 0.0639 \\
					SURF & 1467 & 0.0182 & 1768 & 0.0213 & 1533 & 0.0181 \\
					ORB & 2500 & 0.0102 & 2500 & 0.0128 & 2500 & 0.0116 \\
					MSER & 1044 & 0.2323 & 924 & 0.1586 & 286 & 0.0565 \\
				\end{tabular}
			\end{center}
			\caption{Detectors de keypoints - comparació}
		\end{table}
		\noindent
		Amb aquestes imatges, podem veure com Harris, ORB i SURF són força més rapids que el detector de keypoints de SIFT (DoG). MSER sembla ser el més lent en general i el que menys punts obté.\\\\
		S'ha de tenir en compte que el detector ORB s'ha limitat a 2500 punts.\\
\newpage
		\noindent
		També s'ha provat el sistema amb imatges reals d'entorns coneguts (campus nord i jardins de palau reial).

		\begin{figure}[!htb]
			\minipage{0.32\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.32\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/jardi2}
				\label{fig:awesome_image2}
			\endminipage\hfill
			\minipage{0.32\textwidth}%
				\includegraphics[width=\linewidth]{images/experiments/uni4}
				\label{fig:awesome_image3}
			\endminipage
			\caption{Imatges UPC i jardins}
		\end{figure}

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				%\begin{tabular}{l | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c}
				\begin{tabular}{l | c c | c c | c c}
					& \multicolumn{2}{c|}{\textbf{Campus}} & \multicolumn{2}{c|}{\textbf{Jardins}} & \multicolumn{2}{c}{\textbf{Campus 2}} \\
					\textbf{Algorismes} & \textbf{Punts} & \textbf{Temps (s)} & \textbf{Punts} & \textbf{Temps (s)} & \textbf{Punts} & \textbf{Temps (s)} \\ \hline
					Harris & 2522 & 0.1108 & 1971 & 0.1086 & 2589 & 0.1095 \\
					SIFT & 4621 & 0.7358 & 9690 & 0.8172 & 4750 & 0.7405 \\
					SURF & 7676 & 0.1761 & 14888 & 0.2332 & 10720 & 0.1990 \\
					ORB & 2500 & 0.0515 & 2500 & 0.0978 & 2500 & 0.0618 \\
					MSER & 2135 & 0.6790 & 1141 & 0.3930 & 1798 & 0.6397 \\
				\end{tabular}
			\end{center}
			\caption{Detectors de keypoints - comparació 2}
		\end{table}
		\noindent
		SURF és el que més keypoints detecta, seguit de SIFT. Pel que fa al temps d'execució, SIFT és el més lent, seguit de MSER (el que menys keypoints obté). El més ràpid amb diferència és ORB, pero la
		limitació a 2500 punts probablement farà que no s'obtinguin tan bons resultats.

\newpage
\subsection{Repetibilitat dels detectors de keypoints}
		\begin{figure}[!htb]
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_HARRIS_0}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_HARRIS_1}
				\label{fig:awesome_image2}
			\endminipage
			\caption{HARRIS}
		\end{figure}
		\begin{figure}[!htb]
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_SIFT_0}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_SIFT_1}
				\label{fig:awesome_image2}
			\endminipage
			\caption{SIFT}
		\end{figure}
		\begin{figure}[!htb]
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_ORB_0}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_ORB_1}
				\label{fig:awesome_image2}
			\endminipage
			\caption{ORB}
		\end{figure}

\newpage

		\begin{figure}[!htb]
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_HARRIS_2}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_HARRIS_3}
				\label{fig:awesome_image2}
			\endminipage
			\caption{HARRIS}
		\end{figure}
		\begin{figure}[!htb]
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_SIFT_2}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_SIFT_3}
				\label{fig:awesome_image2}
			\endminipage
			\caption{SIFT}
		\end{figure}
		\begin{figure}[!htb]
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_ORB_2}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.45\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/KP_ORB_3}
				\label{fig:awesome_image2}
			\endminipage
			\caption{ORB}
		\end{figure}

\newpage

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				%\begin{tabular}{l | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c}
				\begin{tabular}{l | c c c | c c c}
					& \multicolumn{3}{c|}{\textbf{Graff}} & \multicolumn{3}{c}{\textbf{Campus}}\\
					\textbf{Algorismes} & \textbf{AB} & \textbf{A !B} & \textbf{A} & \textbf{AB} & \textbf{A !B} & \textbf{A} \\ \hline
					Harris & - & - & - & - & - & - \\
					SIFT & - & - & - & - & - & - \\
					ORB & - & - & - & - & - & - \\
				\end{tabular}
			\end{center}
			\caption{Detectors de keypoints - comparació}
		\end{table}
		\noindent
		...


\newpage
	\subsection{Detecció i extracció de keypoints}
		En primer lloc es prova el sistema amb imatges similars i subimatges, per comprovar  que funciona correctament en els casos més senzills.

		\begin{figure}[!htb]
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni_2}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni}
				\label{fig:awesome_image2}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni4_2}
				\label{fig:awesome_image3}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni4}
				\label{fig:awesome_image3}
			\endminipage
			\caption{Imatges motos i cotxes}
		\end{figure}

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				\begin{tabular}{l | c c c | c c c}
					& \multicolumn{3}{c|}{\textbf{Campus (subimatge)}} & \multicolumn{3}{c}{\textbf{Graff}} \\
					\textbf{Algorismes} & \textbf{OK} & \textbf{Descartats} & \textbf{Erronis} & \textbf{OK} & \textbf{Descartats} & \textbf{Erronis} \\ \hline
					Harris + SIFT & 71 & 14.08\% & 0.1289 & 108 & 34.26\% & 0.5980 \\
					Harris + ORB & 221 & 04.07\% & 0.0437 & 320 & 10.00\% & 0.2816 \\
					SIFT + SIFT & 48 & 43.75\% & 0.4469 & 138 & 69.56\% & 7.9518 \\
					ORB + ORB & 7 & 04.09\% & 0.0771 & 243 & 16.05\% & 0.2952 \\
					ORB + BRISK & 26 & 61.54\% & 0.9651 & 57 & 96.49\% & 1.1579 \\
				\end{tabular}
			\end{center}
			\caption{Matching - comparació sub-imatges}
		\end{table}
		\noindent
		Els resultats obtinguts són bastants dolents. En el cas de la imatge del graffiti sembla ser que el canvi de perspectiva i rotació de la imatge és massa gran.
		Els únics algorismes que aconsegueixen superar el 50\% d'encerts són ORB+BRISK, pero nomès troben 26 matches. Latch, amb els punts obtinguts amb SIFT (DoG) no troba cap coincidència.\\\\
		Pel que fa a la imatge dels jardins, els resultats són una mica millors. ORB+BRISK aconsegueix un 96.49\% d'encerts, encara que amb nomès 57 matches i bastant focalitzats, pel que podria tenir
		problemes per trobar la homografia. SIFT encerta en el 69.56\% dels casos i troba 138 matches. ORB sembla ser el pitjor.\\

		\begin{figure}[!htb]
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/motos3}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/motos1}
				\label{fig:awesome_image2}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/cars4}
				\label{fig:awesome_image3}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/cars6}
				\label{fig:awesome_image3}
			\endminipage
			\caption{Imatges motos i cotxes}
		\end{figure}

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				\begin{tabular}{l | c c c | c c c}
					& \multicolumn{3}{c|}{\textbf{Campus (subimatge)}} & \multicolumn{3}{c}{\textbf{Graff}} \\
					\textbf{Algorismes} & \textbf{OK} & \textbf{Descartats} & \textbf{Erronis} & \textbf{OK} & \textbf{Descartats} & \textbf{Erronis} \\ \hline
					Harris + SIFT & 71 & 14.08\% & 0.1289 & 108 & 34.26\% & 0.5980 \\
					Harris + ORB & 221 & 04.07\% & 0.0437 & 320 & 10.00\% & 0.2816 \\
					SIFT + SIFT & 48 & 43.75\% & 0.4469 & 138 & 69.56\% & 7.9518 \\
					ORB + ORB & 7 & 04.09\% & 0.0771 & 243 & 16.05\% & 0.2952 \\
					ORB + BRISK & 26 & 61.54\% & 0.9651 & 57 & 96.49\% & 1.1579 \\
				\end{tabular}
			\end{center}
			\caption{Matching - comparació imatges similars}
		\end{table}
		\noindent
		Els resultats obtinguts són bastants dolents. En el cas de la imatge del graffiti sembla ser que el canvi de perspectiva i rotació de la imatge és massa gran.
		Els únics algorismes que aconsegueixen superar el 50\% d'encerts són ORB+BRISK, pero nomès troben 26 matches. Latch, amb els punts obtinguts amb SIFT (DoG) no troba cap coincidència.\\\\
		Pel que fa a la imatge dels jardins, els resultats són una mica millors. ORB+BRISK aconsegueix un 96.49\% d'encerts, encara que amb nomès 57 matches i bastant focalitzats, pel que podria tenir
		problemes per trobar la homografia. SIFT encerta en el 69.56\% dels casos i troba 138 matches. ORB sembla ser el pitjor.\\

		\noindent
		També s'han realitzat proves amb les següents fotografies:

		\begin{figure}[!htb]
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni1}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni2}
				\label{fig:awesome_image2}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/jardi_2}
				\label{fig:awesome_image3}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/jardi2}
				\label{fig:awesome_image3}
			\endminipage
			\caption{Imatges Campus i jardins}
		\end{figure}

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				\begin{tabular}{l | c c c | c c c}
					& \multicolumn{3}{c|}{\textbf{Campus (subimatge)}} & \multicolumn{3}{c}{\textbf{Graff}} \\
					\textbf{Algorismes} & \textbf{OK} & \textbf{Descartats} & \textbf{Erronis} & \textbf{OK} & \textbf{Descartats} & \textbf{Erronis} \\ \hline
					Harris + SIFT & 71 & 14.08\% & 0.1289 & 108 & 34.26\% & 0.5980 \\
					Harris + ORB & 221 & 04.07\% & 0.0437 & 320 & 10.00\% & 0.2816 \\
					SIFT + SIFT & 48 & 43.75\% & 0.4469 & 138 & 69.56\% & 7.9518 \\
					ORB + ORB & 7 & 04.09\% & 0.0771 & 243 & 16.05\% & 0.2952 \\
					ORB + BRISK & 26 & 61.54\% & 0.9651 & 57 & 96.49\% & 1.1579 \\
				\end{tabular}
			\end{center}
			\caption{Matching - comparació imatges campus i jardins}
		\end{table}
		\noindent
		SIFT i ORB+BRISK continuent sent els algorismes amb la taxa d'encert més elevada i SIFT+LATCH segueix obtenint molt pocs matches.\\\\
		En els dos conjunts d'imatges, els algorismes confonen en molts casos
		les finestres, ja que realment són iguals i els canvis de zoom i perspectiva fan molt complicat diferenciar-les. En el primer cas, la moto i la porta es detecten força bé.

\newpage
	\subsection{Matching i homografia}
		Aquí podeu veure alguns dels resultats obtinguts a l'executar el programa seleccionant una regió més concreta:
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.7\textwidth]{images/homography}
			\caption{Homografia graff}
		\end{figure}
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.7\textwidth]{images/jardiSel}
			\caption{Homografia jardins}
		\end{figure}

\newpage
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.7\textwidth]{images/uniSel}
			\caption{Homografia campus}
		\end{figure}
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.7\textwidth]{images/uniSel5}
			\caption{Homografia campus 2}
		\end{figure}
