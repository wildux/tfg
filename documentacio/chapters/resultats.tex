\newcolumntype{x}[1]{>{\centering\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash\hspace{0pt}}m{#1}}
%\definecolor{myBlue}{RGB}{210, 230, 255}
\definecolor{myBlue}{RGB}{217, 230, 242}

En aquest capítol es detallen els experiments realitzats i els resultats obtinguts a partir d'aquests.

\section{Experiments realitzats}
	Podeu trobar el codi dels scripts realitzats a l'anex del treball.
	\subsection{Comparació detectors de keypoints}
		Tot i que la velocitat d'execució no és un factor determinant pel projecte, s'ha realitzat una comparació inicial de la velocitat d'execució dels algorismes de detecció de keypoints.\\\\
		Es comparen els següents algorismes:
		\begin{itemize}
			\item{Harris}
			\item{SIFT}
			\item{SURF}
			\item{ORB}
			\item{MSER}
		\end{itemize}
		Per mesurar el temps d'execució, s'agafa la mitja de 5 execucions de la funció d'obtenció de keypoints utilitzada.
	\subsection{Comparació detecció i extracció de keypoints}
		En aquest experiment s'analitzen els diversos algorismes de detecció i extracció de keypoints, tant en la velocitat d'execució com en fiabilitat, que serà el més important pel sistema desenvolupat.\\\\
		Es compararan els següents algorismes:
		\begin{itemize}
			\item{Harris + SIFT}
			\item{Harris + ORB}
			\item{SIFT + SIFT}
			\item{SIFT + LATCH}
			\item{ORB + ORB}
			\item{ORB + BRISK}
			\item{MSER + SIFT}
			\item{MSER + DAISY}
		\end{itemize}
\newpage
\section{Resultats i comparació d'algorismes}
	\subsection{Detectors de keypoints}
	En primer lloc s'han realitzat proves amb imatges típiques de visió per computador.
		\begin{figure}[!htb]
			\minipage{0.32\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/graf3}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.32\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/boat}
				\label{fig:awesome_image2}
			\endminipage\hfill
			\minipage{0.32\textwidth}%
				\includegraphics[width=\linewidth]{images/experiments/ubc}
				\label{fig:awesome_image3}
			\endminipage
			\caption{Imatges graff, boat i ubc}
		\end{figure}

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				%\begin{tabular}{l | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c}
				\begin{tabular}{l | c c | c c | c c}
					& \multicolumn{2}{c|}{\textbf{Graff}} & \multicolumn{2}{c|}{\textbf{Boat}} & \multicolumn{2}{c}{\textbf{Ubc}} \\
					\textbf{Algorismes} & \textbf{Punts} & \textbf{Temps (s)} & \textbf{Punts} & \textbf{Temps (s)} & \textbf{Punts} & \textbf{Temps (s)} \\ \hline
					Harris & 1285 & 0.0123 & 1666 & 0.0124 & 1329 & 0.0101 \\
					SIFT & 1096 & 0.0675 & 1599 & 0.0755 & 1284 & 0.0639 \\
					SURF & 1467 & 0.0182 & 1768 & 0.0213 & 1533 & 0.0181 \\
					ORB & 2500 & 0.0102 & 2500 & 0.0128 & 2500 & 0.0116 \\
					MSER & 1044 & 0.2323 & 924 & 0.1586 & 286 & 0.0565 \\
				\end{tabular}
			\end{center}
			\caption{Detectors de keypoints - comparació}
		\end{table}
		\noindent
		Amb aquestes imatges, podem veure com Harris, ORB i SURF són força més rapids que el detector de keypoints de SIFT (DoG). MSER sembla ser el més lent en general i el que menys punts obté.\\\\
		S'ha de tenir en compte que el detector ORB s'ha limitat a 2500 punts.\\
\newpage
		\noindent
		També s'ha provat el sistema amb imatges reals d'entorns coneguts (campus nord i jardins de palau reial).

		\begin{figure}[!htb]
			\minipage{0.32\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.32\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/jardi2}
				\label{fig:awesome_image2}
			\endminipage\hfill
			\minipage{0.32\textwidth}%
				\includegraphics[width=\linewidth]{images/experiments/uni4}
				\label{fig:awesome_image3}
			\endminipage
			\caption{Imatges UPC i jardins}
		\end{figure}

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				%\begin{tabular}{l | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c | !{\vrule width -1pt}c !{\vrule width -1pt}c}
				\begin{tabular}{l | c c | c c | c c}
					& \multicolumn{2}{c|}{\textbf{Campus}} & \multicolumn{2}{c|}{\textbf{Jardins}} & \multicolumn{2}{c}{\textbf{Campus 2}} \\
					\textbf{Algorismes} & \textbf{Punts} & \textbf{Temps (s)} & \textbf{Punts} & \textbf{Temps (s)} & \textbf{Punts} & \textbf{Temps (s)} \\ \hline
					Harris & 2522 & 0.1108 & 1971 & 0.1086 & 2589 & 0.1095 \\
					SIFT & 4621 & 0.7358 & 9690 & 0.8172 & 4750 & 0.7405 \\
					SURF & 7676 & 0.1761 & 14888 & 0.2332 & 10720 & 0.1990 \\
					ORB & 2500 & 0.0515 & 2500 & 0.0978 & 2500 & 0.0618 \\
					MSER & 2135 & 0.6790 & 1141 & 0.3930 & 1798 & 0.6397 \\
				\end{tabular}
			\end{center}
			\caption{Detectors de keypoints - comparació 2}
		\end{table}
		\noindent
		SURF és el que més keypoints detecta, seguit de SIFT. Pel que fa al temps d'execució, SIFT és el més lent, seguit de MSER (el que menys keypoints obté). El més ràpid amb diferència és ORB, pero la
		limitació a 2500 punts probablement farà que no s'obtinguin tan bons resultats.
\newpage
	\subsection{Detecció i extracció de keypoints}
		Tal com s'ha fet en l'experiment anterior, es prova el sistema amb les imatges de visió i desprès amb fotografies pròpies.

		\begin{figure}[!htb]
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/graf3}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/graf6}
				\label{fig:awesome_image2}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/jardi1}
				\label{fig:awesome_image3}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/jardi2}
				\label{fig:awesome_image3}
			\endminipage
			\caption{Imatges graff i jardins}
		\end{figure}

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				\begin{tabular}{l | c c c | c c c}
					& \multicolumn{3}{c|}{\textbf{Graff}} & \multicolumn{3}{c}{\textbf{Jardins}} \\
					\textbf{Algorismes} & \textbf{Matches} & \textbf{\%} & \textbf{Temps (s)} & \textbf{Matches} & \textbf{\%} & \textbf{Temps (s)} \\ \hline
					Harris + SIFT & 71 & 14.08\% & 0.1289 & 108 & 34.26\% & 0.5980 \\
					Harris + ORB & 221 & 04.07\% & 0.0437 & 320 & 10.00\% & 0.2816 \\
					SIFT + SIFT & 48 & 43.75\% & 0.4469 & 138 & 69.56\% & 7.9518 \\
					SIFT + LATCH & 0 & 00.00\% & 0.2879 & 21 & 66.67\% & 3.9541 \\
					ORB + ORB & 7 & 04.09\% & 0.0771 & 243 & 16.05\% & 0.2952 \\
					ORB + BRISK & 26 & 61.54\% & 0.9651 & 57 & 96.49\% & 1.1579 \\
					MSER + SIFT & - & - & - & - & - & - \\
					MSER + DAISY & - & - & - & - & - & - \\
				\end{tabular}
			\end{center}
			\caption{Matching - comparació}
		\end{table}
		\noindent
		Els resultats obtinguts són bastants dolents. En el cas de la imatge del graffiti sembla ser que el canvi de perspectiva i rotació de la imatge és massa gran.
		Els únics algorismes que aconsegueixen superar el 50\% d'encerts són ORB+BRISK, pero nomès troben 26 matches. Latch, amb els punts obtinguts amb SIFT (DoG) no troba cap coincidència.\\\\
		Pel que fa a la imatge dels jardins, els resultats són una mica millors. ORB+BRISK aconsegueix un 96.49\% d'encerts, encara que amb nomès 57 matches i bastant focalitzats, pel que podria tenir
		problemes per trobar la homografia. SIFT encerta en el 69.56\% dels casos i troba 138 matches. ORB sembla ser el pitjor.\\

		\noindent
		També s'han realitzat proves amb les següents fotografies:

		\begin{figure}[!htb]
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni1}
				\label{fig:awesome_image1}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni2}
				\label{fig:awesome_image2}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni3}
				\label{fig:awesome_image3}
			\endminipage\hfill
			\minipage{0.24\textwidth}
				\includegraphics[width=\linewidth]{images/experiments/uni4}
				\label{fig:awesome_image3}
			\endminipage
			\caption{Imatges UPC}
		\end{figure}

		\begin{table}[H]
			\begin{center}
				\rowcolors{3}{}{myBlue}
				\begin{tabular}{l | c c c | c c c}
					& \multicolumn{3}{c|}{\textbf{Campus 1}} & \multicolumn{3}{c}{\textbf{Campus 2}} \\
					\textbf{Algorismes} & \textbf{Matches} & \textbf{\%} & \textbf{Temps (s)} & \textbf{Matches} & \textbf{\%} & \textbf{Temps (s)} \\ \hline
					Harris + SIFT & 77 & 29.87\% & 0.5308 & 461 & \% & 0.6783 \\
					Harris + ORB & 212 & 10.38\% & 0.2514 & 617 & 20.10\% & 0.2881 \\
					SIFT + SIFT & 150 & 60.67\% & 2.6028 & 520 & \% & 3.6935 \\
					SIFT + LATCH & 19 & 10.53\% & 1.7193 & 351 & \% & 2.2701 \\
					ORB + ORB & 414 & 11.84\% & 0.1942 & 580 & \% & 0.2200 \\
					ORB + BRISK & 143 & 54.55\% & 1.0620 & 328 & \% & 1.0876 \\
					MSER + SIFT & - & - & - & - & - & - \\
					MSER + DAISY & - & - & - & - & - & - \\
				\end{tabular}
			\end{center}
			\caption{Matching - comparació 2}
		\end{table}
		\noindent
		SIFT i ORB+BRISK continuent sent els algorismes amb la taxa d'encert més elevada i SIFT+LATCH segueix obtenint molt pocs matches.\\\\
		En els dos conjunts d'imatges, els algorismes confonen en molts casos
		les finestres, ja que realment són iguals i els canvis de zoom i perspectiva fan molt complicat diferenciar-les. En el primer cas, la moto i la porta es detecten força bé.

\newpage
	\subsection{Matching i homografia}
		Aquí podeu veure alguns dels resultats obtinguts a l'executar el programa seleccionant una regió més concreta:
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.7\textwidth]{images/homography}
			\caption{Homografia graff - SIFT}
		\end{figure}
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.7\textwidth]{images/jardiSel}
			\caption{Homografia jardins - ORB+BRISK}
		\end{figure}

\newpage

		\begin{figure}[H]
			\centering
			\includegraphics[width=0.7\textwidth]{images/uniSel}
			\caption{Homografia campus - SIFT}
		\end{figure}
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.7\textwidth]{images/uniSel5}
			\caption{Homografia campus 2 - SIFT}
		\end{figure}
